<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>我要报修</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"></meta>
    <link href="CSS/baixiu-apply.css" rel="stylesheet">
    <script src="lib/jquery-2.1.4.min.js"></script>
    <script src="lib/jquery.form.js"></script>
</head>

<body ng-controller="applyCtrl">
    <div class="header">
        <div class="topic">
            <a href="#"><img src="images/baoxiu/return-icon.png" alt="" /></a>
            <p>我要报修</p>
        </div>
    </div>
    <form id="formid" enctype="multipart/form-data" name="myform" method='post'>
        <div class="main">
            <div class="deta">
                <span>维修物品:</span>
                <input id="repairTh" name="title" type="text">
            </div>
            <div class="deta">
                <span>具体内容:</span>
                <textarea id="repairMsg" name="content"></textarea>
            </div>
            <div class="deta" ng-controller="UploaderController">
                <span>现场图片:</span>
                <div id="pic">
                    <label for="picture"><img for="d" ng-src="{{imageSrc}}" src="images/baoxiu/addpic.jpg" /></label>
                    <input type="file" id="picture" file-model="myFile" hidden name="image">
                </div>
            </div>
            <div class="footer">
                <span>我的地址</span>
                <div id="addre">
                    <p>万达小区 &nbsp #26栋 &nbsp 604室</p>
                    <p>王刚先生 &nbsp 10016341859</p>
                </div>
            </div>
            <input type="submit" class="btn" value="提交" class="btn2" />
            <div id="ajax_upload_message"></div>
        </div>
    </form>
</body>
<script>
$(function() {

    $("#formid").submit(function() {
        alert("submit");
        $("#formid").ajaxSubmit({
            type: "post", //提交方式  
            dataType: "json", //数据类型  
            url: "/api/repair/send", //请求url  
            success: function(data) { //提交成功的回调函数  
                console.log(data.type);
                if (data.type == "success") {
                    clearForm(formid);
                }
            }
        });
        return false; //不刷新页面  
    });


});

function clearForm(form) {
    $(':input', form).each(function() {
        var type = this.type;
        var tag = this.tagName.toLowerCase(); // normalize case
        if (type == 'text' || type == 'password' || tag == 'textarea')
            this.value = "";
        else if (type == 'checkbox' || type == 'radio')
            this.checked = false;
        else if (tag == 'select')
            this.selectedIndex = -1;
        else if (type == 'file')
            $('img',form).attr("src","images/baoxiu/addpic.jpg");
    });
}; 
</script>

</html>
